<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/[email protected]/dist/js/bootstrap.bundle.min.js" integrity="sha384-1CmrxMRARb6aLqgBO7yyAxTOQE2AKb9GfXnEo760AUcUmFx3ibVJJAzGytlQcNXd" crossorigin="anonymous"></script>

<div class="wrapper">
    <div class="left-col">
        <div class="post">
            <div class="info">
                <div class="user">
                    <%# <div class="profile-pic"><img src="img/cover 1.png" alt=""></div> %>
                    <h5 class="username"> Uploaded by <%= @attachment.user.first_name %>üï∫üèª</h5>
                </div>
                <%# <img src="img/option.PNG" class="options" alt=""> %>
            </div>
            <div class="attachment-post">
                <% @attachment.posts.each do |post| %>
                  <% if post.content_type.include?("image") %>
                    <%= link_to (cl_image_tag post.key, class:"img-event-gallery", crop: :fill), attachment_path(@attachment) %>
                  <% else %>
                    <%= link_to (cl_video_tag post.key, controls: true, crop: :fill, class:"unique-post"), attachment_path(@attachment)%>
                  <% end %>
                  <%# <%= cl_image_tag post.key, crop: :fill, class:"unique-post" %>
                <% end %>
            </div>
            <div class="post-content">
              <div class = "likes-icon d-flex justify-content-start" >
                <p class="likes"><%= @attachment.likes.size %> Likes</p>
                  <% like = current_user.likes.find_by(attachment: @attachment) %>
                  <% if like.nil? %>
                    <%= link_to  attachment_likes_path(@attachment), data: {turbo_method: :post}, class:"likes-icons" do %>
                      <i class="fa-regular fa-heart"></i>
                    <% end %>
                  <% else %>
                    <%= link_to like_path(like), data: {turbo_method: :delete}, class:"likes-icons" do %>
                      <i class="fa-solid fa-heart"></i>
                    <% end %>
                  <% end %>
              </div>
              <div class = "comments-text">
                <p class="description"><span>username </span> Lorem ipsum dolor sit amet consectetur, adipisicing elit. Pariatur?</p>
                <p class="post-time">2 minutes ago</p>
                <% if @attachment.comments.any? %>
                  <% @attachment.comments.each do |comment| %>
                    <div class="initials-and-comments d-flex justify-content-between">
                      <div class="initials-comment">
                      <p class="initials-circle" data-toggle="popover" data-trigger="focus" title="<%= comment.user.fullname %>"><em><%= comment.user.initials %></em></p>
                      <script>
                        $(document).ready(function() {
                          $('[data-toggle="popover"]').popover();
                        });
                      </script>
                      </div>
                      <div class="comment-text flex-grow-1">
                        <p><%= comment.content %></p>
                      </div>
                      <div class="edit-and-delete-icons">
                        <%if policy(comment).edit? %>
                          <%= link_to edit_attachment_comment_path(@attachment, comment) do %>
                            <i class="fa-solid fa-pen-to-square"></i>
                          <% end  %>
                        <% end %>
                        <% if policy(comment).destroy? %>
                          <%= link_to comment_path(comment) , data: {turbo_method: :delete, turbo_confirm: "Are you sure?"},class:"trash-comment-icon" do %>
                            <i class="fa-solid fa-trash-can"></i>
                          <% end %>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
        </div>
    </div>
</div>




<div data-controller="insert-in-comments-text">
  <div data-insert-in-comments-text-target="comments">
    <!-- [...] -->
  </div>
  <% if policy(@comment).create? %>
  <div class="comment-box">
    <%= simple_form_for([@attachment, @comment],
      data: {insert_in_comments_text_target: "form", action: "submit->insert-in-comments-text#send"}) do |f|%>
      <div class="position-relative">
        <%= f.text_area :content, placeholder: "Add a comment...", class: "comment-input" %>
        <%= button_tag type: :submit, class: "comment-btn" do %>
        <%#= f.submit "Post", class:"comment-btn" do %>
            <i class="fa-regular fa-paper-plane"></i>
          <% end %>
        <!-- [...] -->
      </div>
    <% end %>
  </div>
  <% end %>
</div>
